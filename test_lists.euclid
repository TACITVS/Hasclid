-- Test Bulk Points and Indexing
:verbose

-- 1. Define 5 points P1..P5
:points P 5

-- 2. Define a macro to sum distances between consecutive points P_i and P_{i+1}
--    Uses (idx P i) to construct variable names dynamically
:macro sum_dist i = (if (= i 1) 0 (+ (dist2 (idx P (- i 1)) (idx P i)) (sum_dist (- i 1))))

-- 3. Test expansion
-- Should expand to dist2(P4,P5) + dist2(P3,P4) + dist2(P2,P3) + dist2(P1,P2) + 0
-- We check if the formula parses and expands correctly.
-- Since P1..P5 are symbolic, the result is a large polynomial.
-- We just check if it runs without error.
(= (sum_dist 5) (sum_dist 5))
