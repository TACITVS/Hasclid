-- Test Lazy Determinant Optimization
:verbose
:set-order grevlex

-- 1. Trivial: 2x2 with zero row
-- | 0 0 |
-- | 1 2 |
-- Should simplify to 0 before expansion
(= (det 0 0 1 2) 0)

-- 2. Dependent Rows
-- | 1 2 |
-- | 1 2 |
(= (det 1 2 1 2) 0)

-- 3. Cayley-Menger Matrix (Symbolic) - Dependent Rows Test
-- Create a 3x3 matrix with two identical rows
:macro det3_dep a b c = (det a b c a b c 1 2 3)
(= (det3_dep x y z) 0)

-- 4. Cayley-Menger Logic (Simplified)
-- Verify that we can define CM using 'det' primitive
:macro d12 = (dist2 P1 P2)
:macro d13 = (dist2 P1 P3)
:macro d23 = (dist2 P2 P3)

-- A generic 3x3 Cayley-Menger matrix for 3 collinear points (should be 0)
-- (Using simple numbers to verify expansion works if logic holds)
-- | 0   d12 d13 |
-- | d12 0   d23 |
-- | d13 d23 0   |
:macro CM3 = (det 0 d12 d13 d12 0 d23 d13 d23 0)

:point P1 0 0
:point P2 1 0
:point P3 2 0
-- d12=1, d13=4, d23=1.
-- Matrix:
-- 0 1 4
-- 1 0 1
-- 4 1 0
-- Det = -1(0-4) + 4(1-0) = 4 + 4 = 8.
-- Wait, Cayley-Menger usually borders with 1s.
-- This is just testing if 'det' computes correctly.
(= CM3 8)
