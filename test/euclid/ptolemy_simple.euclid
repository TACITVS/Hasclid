-- ============================================================================
-- PTOLEMY'S THEOREM - Simplified Algebraic Proof
-- ~100 CE, Claudius Ptolemy
-- ============================================================================
--
-- THEOREM: For a cyclic quadrilateral (inscribed in a circle),
-- |AC| · |BD| = |AB| · |CD| + |BC| · |DA|
--
-- SIMPLIFIED APPROACH: Use the Bretschneider identity specialized to cyclic quadrilaterals
-- For cyclic quadrilaterals, opposite angles sum to π, so cos(A+C) = -1
-- This simplifies Ptolemy's relation significantly
-- ============================================================================

:verbose

-- Place four points on unit circle
:assume (= (+ (^ xA 2) (^ yA 2)) 1)
:assume (= (+ (^ xB 2) (^ yB 2)) 1)
:assume (= (+ (^ xC 2) (^ yC 2)) 1)
:assume (= (+ (^ xD 2) (^ yD 2)) 1)

-- KEY INSIGHT: Use the complex number representation
-- For points on unit circle: A = e^(iα), B = e^(iβ), C = e^(iγ), D = e^(iδ)
-- In coordinates: A = (cos α, sin α), etc.
-- The squared distance is: |B - A|² = (e^(iβ) - e^(iα))(e^(-iβ) - e^(-iα))
--                                    = 2 - 2cos(β-α)
--                                    = 2 - 2(xA·xB + yA·yB)

-- Define squared distances using dot products
:assume (= dAB2 (- 2 (* 2 (+ (* xA xB) (* yA yB)))))
:assume (= dBC2 (- 2 (* 2 (+ (* xB xC) (* yB yC)))))
:assume (= dCD2 (- 2 (* 2 (+ (* xC xD) (* yC yD)))))
:assume (= dDA2 (- 2 (* 2 (+ (* xD xA) (* yD yA)))))
:assume (= dAC2 (- 2 (* 2 (+ (* xA xC) (* yA yC)))))
:assume (= dBD2 (- 2 (* 2 (+ (* xB xD) (* yB yD)))))

-- Ptolemy squared: (|AC| · |BD|)² = (|AB| · |CD| + |BC| · |DA|)²
-- LHS: dAC2 · dBD2
:assume (= LHS (* dAC2 dBD2))

-- RHS: (sqrt(dAB2) · sqrt(dCD2) + sqrt(dBC2) · sqrt(dDA2))²
-- Expanding: = dAB2·dCD2 + 2·sqrt(dAB2·dCD2·dBC2·dDA2) + dBC2·dDA2

-- Define the product under the sqrt
:assume (= prod4 (* (* dAB2 dCD2) (* dBC2 dDA2)))

-- Define aux variable for the sqrt term: aux² = prod4
:assume (= (^ aux 2) prod4)

-- RHS = dAB2·dCD2 + 2·aux + dBC2·dDA2
:assume (= RHS (+ (+ (* dAB2 dCD2) (* 2 aux)) (* dBC2 dDA2)))

-- THE PROOF
(= LHS RHS)
