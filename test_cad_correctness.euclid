-- ============================================================================
-- CAD CORRECTNESS TEST SUITE
-- ============================================================================
-- Purpose: Expose false positives and verify soundness of CAD solver
-- Date: 2025-12-03
-- Status: REGRESSION TEST - Some tests SHOULD FAIL to expose bugs
-- ============================================================================

-- ============================================================================
-- SECTION 1: KNOWN FALSE POSITIVE (BUG!)
-- ============================================================================

-- Test 1.1: xy + 1 > 0 is NOT universally true
-- Expected: NOT PROVED (or at least a warning)
-- ACTUAL BEHAVIOR: Says "PROVED" (FALSE POSITIVE!)
-- Counterexample: x=-1, y=2 gives -1 < 0
(> (+ (* x y) 1) 0)

:reset

-- Test 1.2: Verify the counterexample explicitly
-- Expected: NOT PROVED (correctly rejects when given concrete values)
-- This WORKS correctly
:assume (= x -1)
:assume (= y 2)
(> (+ (* x y) 1) 0)

:reset

-- Test 1.3: Another counterexample
-- x=-10, y=1: xy+1 = -9 < 0
:assume (= x -10)
:assume (= y 1)
(> (+ (* x y) 1) 0)

:reset

-- ============================================================================
-- SECTION 2: TRUE INEQUALITIES (Should all be PROVED)
-- ============================================================================

-- Test 2.1: Sum of squares (trivial)
-- Expected: PROVED
(>= (+ (^ x 2) (^ y 2)) 0)

:reset

-- Test 2.2: Univariate square
-- Expected: PROVED
(>= (^ x 2) 0)

:reset

-- Test 2.3: (x-y)^2 >= 0 (expanded form)
-- Expected: PROVED
(>= (- (+ (^ x 2) (^ y 2)) (* 2 (* x y))) 0)

:reset

-- Test 2.4: Triangle inequality (concrete points)
-- Expected: PROVED
:point A 0 0
:point B 3 4
:point C 6 0
(>= (+ (dist2 A B) (dist2 B C)) (dist2 A C))

:reset

-- Test 2.5: x^2 + 1 > 0 (always positive)
-- Expected: PROVED
(> (+ (^ x 2) 1) 0)

:reset

-- ============================================================================
-- SECTION 3: FALSE INEQUALITIES (Should all be NOT PROVED)
-- ============================================================================

-- Test 3.1: x > 0 is not universal
-- Expected: NOT PROVED
(> x 0)

:reset

-- Test 3.2: x - 1 > 0 is not universal
-- Expected: NOT PROVED
(> (- x 1) 0)

:reset

-- Test 3.3: xy > 1 is not universal
-- Expected: NOT PROVED
(> (* x y) 1)

:reset

-- Test 3.4: x^2 > 1 is not universal (fails at x=0)
-- Expected: NOT PROVED
(> (^ x 2) 1)

:reset

-- Test 3.5: xy > 0 is not universal (fails in quadrants II and IV)
-- Expected: NOT PROVED
(> (* x y) 0)

:reset

-- ============================================================================
-- SECTION 4: EDGE CASES
-- ============================================================================

-- Test 4.1: Zero polynomial >= 0
-- Expected: PROVED
(>= 0 0)

:reset

-- Test 4.2: Constant positive
-- Expected: PROVED
(> 5 0)

:reset

-- Test 4.3: Constant negative should fail
-- Expected: NOT PROVED
(> -3 0)

:reset

-- Test 4.4: Equality vs inequality
-- x^2 = 0 is only true at x=0, but x^2 >= 0 is always true
(>= (^ x 2) 0)

:reset

-- ============================================================================
-- SECTION 5: MULTIVARIATE EDGE CASES
-- ============================================================================

-- Test 5.1: x^2 + y^2 + 1 > 0 (strictly positive)
-- Expected: PROVED
(> (+ (+ (^ x 2) (^ y 2)) 1) 0)

:reset

-- Test 5.2: x^2 - y^2 >= 0 is NOT universal (hyperbola)
-- Expected: NOT PROVED
(>= (- (^ x 2) (^ y 2)) 0)

:reset

-- Test 5.3: (x+y)^2 >= 0 (expanded)
-- Expected: PROVED
(>= (+ (+ (^ x 2) (* 2 (* x y))) (^ y 2)) 0)

:reset

-- ============================================================================
-- END OF TEST SUITE
-- ============================================================================
-- Summary:
-- - Section 1: Exposes FALSE POSITIVE bug
-- - Section 2: Verifies TRUE inequalities work
-- - Section 3: Verifies FALSE inequalities are rejected
-- - Section 4: Edge cases with constants
-- - Section 5: Complex multivariate cases
-- ============================================================================
